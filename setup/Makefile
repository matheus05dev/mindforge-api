.PHONY: help dev up down clean logs test build

help:
	@echo "ğŸ§  MindForge - Available commands (Run from setup/ folder):"
	@echo ""
	@echo "  make dev       - Start DB + Ollama (for local development)"
	@echo "  make up        - Start all services (DB + Ollama + API)"
	@echo "  make down      - Stop all services"
	@echo "  make clean     - Stop and remove all containers + volumes"
	@echo "  make logs      - Show logs from all services"
	@echo "  make test      - Run tests"
	@echo "  make build     - Build API jar"
	@echo "  make setup-ai  - Download Ollama models"
	@echo ""

# Modo dev: sÃ³ DB + Ollama (API roda na IDE)
dev:
	@echo "ğŸš€ Starting dev environment (DB + Ollama)..."
	docker-compose up -d postgres ollama
	@echo "â³ Waiting for services to be ready..."
	@sleep 5
	@echo "âœ… Dev environment ready!"
	@echo ""
	@echo "ğŸ“Š Database:  postgresql://localhost:5432/mindforge"
	@echo "ğŸ¤– Ollama:    http://localhost:11434"
	@echo ""
	@echo "ğŸ’¡ Run 'make setup-ai' to download AI models"
	@echo "ğŸ’¡ Then start API: ../mvnw spring-boot:run"

# Todos os serviÃ§os (incluindo API)
up:
	@echo "ğŸš€ Starting full stack..."
	docker-compose up -d
	@echo "â³ Waiting for services..."
	@sleep 10
	@echo "âœ… All services ready!"
	@echo ""
	@echo "ğŸŒ API:       http://localhost:8080"
	@echo "ğŸ“– Swagger:  http://localhost:8080/swagger-ui.html"
	@echo "ğŸ“Š Database: postgresql://localhost:5432/mindforge"
	@echo "ğŸ¤– Ollama:   http://localhost:11434"

# Para tudo
down:
	@echo "ğŸ›‘ Stopping all services..."
	docker-compose down
	@echo "âœ… All services stopped"

# Limpa tudo (containers + volumes)
clean:
	@echo "ğŸ§¹ Cleaning up..."
	docker-compose down -v
	@echo "âœ… All containers and volumes removed"

# Logs
logs:
	docker-compose logs -f

# Testes
test:
	@echo "ğŸ§ª Running tests..."
	../mvnw test

# Build
build:
	@echo "ğŸ”¨ Building API..."
	../mvnw clean package -DskipTests
	@echo "âœ… Build complete: target/*.jar"

# Setup AI models
setup-ai:
	@bash setup-ollama.sh
